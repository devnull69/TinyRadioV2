<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
   <meta http-equiv="X-UA-Compatible" content="ie=edge">
   <title>TinyRadio V2 Testseite</title>
   <script>

      let stations = [{
         name: "Rock Antenne Heavy Metal",
         src: "https://mp3channels.webradio.de/heavy-metal?&aw_0_1st.playerid=RockAntenneWebPlayer&aw_0_1st.listenerid=80423ecc532e6d7ebfe863577b38f2fc&aw_0_1st.skey=1562653242&aw_0_1st.gpslat=51.514&aw_0_1st.gpslong=7.476&aw_0_req.gdpr=true&aw_0_1st.spotcom=%5B%5D",
         titleUrl: "https://api.radio.de/info/v2/search/nowplaying?_=1562664938269&apikey=12658da845d57f57481889773a85840489415408&numberoftitles=1&station=9148",
         active: true
      }, {
         name: "Wacken Radio",
         src: "https://de-hz-fal-stream02.rautemusik.fm/wackenradio",
         titleUrl: "http://www.rautemusik.fm/wackenradio/",
         active: true
      }, {
         name: "Metal Hammer",
         src: "https://metal-hammer.stream.laut.fm/metal-hammer",
         titleUrl: "http://api.laut.fm/station/metal-hammer/current_song",
         active: true
      }, {
         name: "Up The Irons",
         src: "https://uptheirons.stream.laut.fm/up_the_irons",
         titleUrl: "http://api.laut.fm/station/up_the_irons/current_song",
         active: true
      }, {
         name: "Radio 91.2 Lokalradio",
         src: "http://dg-ais-eco-http-fra-eco-cdn.cast.addradio.de/radio912/live/mp3/high?ar-distributor=f0b7",
         titleUrl: "https://api-prod.nrwlokalradios.com/playlist/latest?station=6&req_station=6&count=3",
         active: true
      }, {
         name: "Radio 91.2 80er Radio",
         src: "http://dg-ais-eco-http-fra-eco-cdn.cast.addradio.de/rnrw-014D/dein80er/high/stream.mp3?ar-purpose=web&ar-distributor=f0b7&sid=014d",
         titleUrl: "https://api-prod.nrwlokalradios.com/playlist/latest?station=1001&req_station=6&count=3",
         active: true
      }];

      let playing = -1;

      function stopAudio() {
         let audio = document.querySelector("audio");
         let src = document.querySelector("source");

         audio.pause();
         src.src = "";
         audio.load();
      }

      function playAudio(idx) {
         let audio = document.querySelector("audio");
         let src = document.querySelector("source");

         src.src = stations[idx].src;
         audio.load();
         audio.play();
      }

      window.addEventListener('load', function() {

         let audio = document.querySelector("audio");
         let currButton = null;

         audio.addEventListener("canplay", () => {
            currButton.style.backgroundColor = "lightgreen";
         });

         audio.addEventListener("pause", () => {
            stopAudio();
            let btn = document.querySelectorAll("button")[playing];
            btn.style.backgroundColor = "";
         });

         for(let i=0; i<stations.length; i++) {
            let station = stations[i];

            let paragraph = document.createElement("p");
            let button = document.createElement("button");
            button.type = "button";
            button.textContent = station.name;

            button.addEventListener("click", () => {
               if(station.active) {
                  if(playing != -1) {
                     stopAudio();
                     let btn = document.querySelectorAll("button")[playing];
                     btn.style.backgroundColor = "";
                  }
                  if(playing != i) {
                     playAudio(i);
                     playing = i;
                     button.style.backgroundColor = "yellow";
                     currButton = button;
                  } else {
                     button.style.backgroundColor = "";
                     playing = -1;
                     currButton = null;
                  }
               }
            }, false);

            if(!station.active) {
               button.style.backgroundColor = "#cc2000";
               button.style.color = "white";
            }

            paragraph.appendChild(button);
            document.body.appendChild(paragraph);
         }
      }, false);
   </script>
</head>
<body>
   <audio>
      <source src="" type="audio/mpeg"/>
   </audio>
</body>
</html>